# EScheduler
–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç–ø—Ä–æ–µ–∫—Ç EScheduler. EScheduler - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–í–°) –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ —Ç–∏–ø–∞, —Å–æ—Å—Ç–æ—è—â–∞—è –∏–∑ –ø–æ–¥—Å–∏—Å—Ç–µ–º —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö  –∏ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
## –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

msr_exporter - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–± —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –¶–ü–£ –Ω–∞ –í–° —Å –û–° Linux.

**–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**

msr_exporter –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å RAPL

- Intel –Ω–∞—á–∏–Ω–∞—è —Å –∞—Ä—Ö–∏–µ—Ç–∫—Ç—É—Ä—ã Sandy Bridge
- AMD –Ω–∞—á–∏–Ω–∞—è —Å –∞—Ä—Ö–∏—Ç–∫—Ç—É—Ä—ã Pyzen

–î–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö msr_exporter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç msr-—Ä–µ–≥–∏—Å—Ç—Ä—ã

–í—Å–µ–≥–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –¥–æ–º–µ–Ω–æ–≤ RAPL:

- –ß–∏—Ç–∞—Ç—å msr-—Ä–µ–≥–∏—Å—Ç—Ä—ã –Ω–∞–ø—Ä—è–º—É—é —Å /dev/cpu/%d/msr
- –ß–µ—Ä–µ–∑ perf_event_open() interface (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è AMD)
- –ß–µ—Ä–µ–∑ sysfs powercap (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è AMD)

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å powercup –∏–ª–∏ sysfs –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [node_exporter](https://github.com/prometheus/node_exporter)

msr_exporter –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–º–µ–Ω—ã RAPL package(PP0, PP1, DRAM), platform(PSys)

msr_exporter (–ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç AMD —Ä–∞—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–æ –ø—Ä–∏—á–∏–Ω–µ. —Ç–æ–≥–æ, —á—Ç–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –≤—ã—è—Å–Ω–∏—Ç—å –∫–∞–∫–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ AMD –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö)

**üíæ –ö–æ–ø–∏–ª—è—Ü–∏—è**

node_exporter –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ —è–∑—ã–∫–µ go

–î–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å 

```
go build main.go
```

–¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–µ—Ä–µ–µ–º–µ–Ω–Ω—ã–µ GOOS –∏ GOARCH —Ä–∞–≤–Ω—ã linux –∏ amd64 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ

**üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã**

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥—Ä–∞–π–≤–µ—Ä 

```bash
modprobe msr
```

–¢–∞–∫–∂–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è root –ø—Ä–∞–≤–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∑–∞–¥–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ msr_exporter.yaml

–í—Å–µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ 

- Address - —ç—Ç–æ –∞–¥—Ä–µ—Å –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥—É—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ—Ç—Ä–∏–∫–∏
- Interface - —ç—Ç–æ –¥—Ä–∞–π–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ msr-—Ä–µ–≥–∏—Å—Ç—Ä–∞–º –Ω–∞–ø—Ä–∏–º–µ—Ä `/dev/cpu/%d/msr` –∏–ª–∏ `/dev/cpu/%d/msr_safe`

**üí° Systemd —Å–µ—Ä–≤–∏—Å**

msr_exporter –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ —Å–µ—Ä–≤–∏—Å.

–î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª msr_exporter.service  –≤ `/etc/systemd/system` –≤ ExecStart –ø—Ä–æ–ø–∏—Å–∞—Ç—å –ø—É—Ç—å –¥–æ –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–æ–º –∏ —Ñ–∞–π–ª–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## –ü–æ–¥—Å–∏—Å–∏—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—É—á–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç Prometheus –ø–æ HTTP API –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ –ø–æ—Å—Ç–≥—Ä–µ—Å, –ø–æ—Å–ª–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —ç—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞–Ω–∏—è —Å —É—á–µ—Ç–æ–º —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è, –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∫–∞–∫–∞–∏—Ö –í–° —É–∂–µ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å –¥–∞–Ω–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (–µ—Å–ª–∏ –Ω–∞ –∫–∞–∫–æ–π-—Ç–æ —Å–∏—Å—Ç–µ–º–µ –æ–Ω–∞ –¥–æ —ç—Ç–æ–≥–æ –Ω–µ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞, —Å—á–∏—Ç–∞–µ—Ç—Å—è —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä—Ä–∞–≤–Ω—ã–º –Ω—É–ª—é) –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ç—É —Å–∏—Å—Ç–µ–º—É, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –ø–∏–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –±—ã–ª–æ –Ω–∞–∏–º–µ–Ω—å—à–∏–º.

## –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏–∏ –¥–∞–Ω–Ω—ã—Ö
–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ, —Å—Ä–µ–¥–Ω–µ–µ –∏ —Å—É–º–º–∞—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –∫–∞–∫ –¥–ª—è –æ–¥–Ω–æ–π, —Ç–∞–∫ –∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–∞–Ω–Ω—ã–µ –æ–± —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º, —Ç–∞–∫ –∏ –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –≤–∏–¥–µ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–∏–∞–≥—Ä–∞–º–º –∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ Grafana.
